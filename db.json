{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":1,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":1,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.png","path":"img/favicon.png","modified":1,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/_posts/Vue3源码学习.md","hash":"957c711e9f31392cf5b344a52bceec723b2d164e","modified":1642476622000},{"_id":"source/_posts/Windows-Terminal-powershell-美化.md","hash":"f891bbeb997b91d32f8cf643db85594a6b25ebdd","modified":1640491476000},{"_id":"source/_posts/撸一个Promise.md","hash":"2781b9f3eabca7a7e0bf03ec7f75e03fc1e35cba","modified":1629614076000},{"_id":"themes/butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1661396701574},{"_id":"themes/butterfly/package.json","hash":"a937d4aa286401430c672bce28d93fe417d87a1e","modified":1661396701600},{"_id":"themes/butterfly/README.md","hash":"249abda2d59e738d8e5416c9b0e2727fc73493dd","modified":1661396701575},{"_id":"themes/butterfly/_config.yml","hash":"1c022517177d1322edc12e3e3365a01df2bc414b","modified":1661396754618},{"_id":"themes/butterfly/README_CN.md","hash":"ec3df032fa5e197eef3822c1af517e29a91da2df","modified":1661396701575},{"_id":"themes/butterfly/plugins.yml","hash":"b96cbef0a8af718b1b7bbe3317bb7a15484e7985","modified":1661396701600},{"_id":"themes/butterfly/languages/default.yml","hash":"1e37a3695d50e3e61d7c36e58a6dac872a4a56cd","modified":1661396701576},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"947f794e862bb2813e36887f777bdb760f70a322","modified":1661396701577},{"_id":"themes/butterfly/languages/en.yml","hash":"d1bb560698eb8b0079495b7b18b44facb610f9fd","modified":1661396701576},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"28b6f0c39155651d747eb595e0a283bc97be2e09","modified":1661396701576},{"_id":"themes/butterfly/layout/archive.pug","hash":"a0c034c2d319320a54046805e80b58dc48b7e233","modified":1661396701577},{"_id":"themes/butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1661396701577},{"_id":"themes/butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1661396701599},{"_id":"themes/butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":1661396701599},{"_id":"themes/butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1661396701600},{"_id":"themes/butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1661396701600},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"67e4f5a66d4b8cabadbaad0410628364ee75e0ae","modified":1661396701573},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7dfe7189ffeaebb6db13842237f8e124649bea3d","modified":1661396701573},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1661396701574},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":1661396701574},{"_id":"themes/butterfly/.github/workflows/stale.yml","hash":"ac62b989b5550c756e1986fcc68f243170705383","modified":1661396701574},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"594a977ebe8d97e60fa3d7cb40fc260ded4d8a58","modified":1661396701579},{"_id":"themes/butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1661396701579},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":1661396701579},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"de8e618ec03295561c667a49e1c383213b856f6f","modified":1661396701579},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"a557280a25f63f4312afad63fc3303ec74165557","modified":1661396701583},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"0b80f04950bd0fe5e6c4e7b7559adf4d0ce28436","modified":1661396701585},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"699d0d2cff233628752956c4434125c8203f7d63","modified":1661396701585},{"_id":"themes/butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1661396701601},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"8d39473ed112d113674a0f689f63fae06c72abd2","modified":1661396701585},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"acfe765fb2c607bff7198630dbfa53a888c36357","modified":1661396701601},{"_id":"themes/butterfly/scripts/events/comment.js","hash":"a3d1f417965ca20253c36f9e93429f3df6268856","modified":1661396701601},{"_id":"themes/butterfly/scripts/events/init.js","hash":"b4940a5c73d3a5cd8bb5883e3041ecdd905a74e0","modified":1661396701601},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":1661396701601},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"3cfc46c749e2fd7ae9c2a17206238ed0e0e17e7d","modified":1661396701601},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":1661396701602},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"21379ed2dccb69c43b893895c9d56238c11e5f43","modified":1661396701602},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":1661396701604},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1661396701604},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"f79c99f6c5b626c272dc2bed2b0250d6b91bb28a","modified":1661396701604},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":1661396701604},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":1661396701604},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":1661396701605},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":1661396701605},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"d51812b43924f1bbf413c67499510dd125022005","modified":1661396701605},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":1661396701605},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":1661396701605},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1661396701602},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":1661396701603},{"_id":"themes/butterfly/scripts/helpers/findArchiveLength.js","hash":"ee3e70098eb0849497d50b75e18cf4a27c397d52","modified":1661396701603},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"b4cd617c619d1a0df93603721a6fa1317526174b","modified":1661396701603},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"d368a8830e506c8b5eb6512b709ec8db354d5ea1","modified":1661396701603},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"763dab5c83f50c1c62fffc9a9dfedea29bb4e629","modified":1661396701603},{"_id":"themes/butterfly/source/css/index.styl","hash":"861998e4ac67a59529a8245a9130d68f826c9c12","modified":1661396701616},{"_id":"themes/butterfly/source/css/var.styl","hash":"4890a40366d6443f8b8942a4e9a6dce9fe3494f5","modified":1661396701616},{"_id":"themes/butterfly/source/js/main.js","hash":"73d2624ed465e4cfb1ebb00b2c8a24f5fc29bb21","modified":1661396701618},{"_id":"themes/butterfly/source/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1661396701620},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1661396701619},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1661396701617},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"6c41f49a3e682067533dd9384e6e4511fc3a1349","modified":1661396701580},{"_id":"themes/butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1661396701617},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"8f41fa9732ea654a10f6e666d9c782c7e27e5ea6","modified":1661396701580},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1661396701618},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"15530d9ac59c576d79af75dd687efe71e8d261b0","modified":1661396701580},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1661396701580},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1661396701581},{"_id":"themes/butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":1661396701581},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1661396701580},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1661396701581},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"65a23b5170204e55b813ce13a79d799b66b7382c","modified":1661396701581},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"aa175e2254704335f4da09175e59ef2375ca7d03","modified":1661396701582},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"78a3abd90bb3c18cd773d3d5abac3541e7f415e5","modified":1661396701582},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1661396701582},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"9698f22751778dde063cbfbd01c59ca4462ccd85","modified":1661396701582},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"0d953e51d04a9294a64153c89c20f491a9ec42d4","modified":1661396701582},{"_id":"themes/butterfly/layout/includes/loading/loading-js.pug","hash":"4cfcf0100e37ce91864703cd44f1cb99cb5493ea","modified":1661396701583},{"_id":"themes/butterfly/layout/includes/loading/loading.pug","hash":"5276937fbcceb9d62879dc47be880cd469a27349","modified":1661396701583},{"_id":"themes/butterfly/layout/includes/mixins/post-ui.pug","hash":"6ae047d566289294cc2f6192cacbff297cec9f1a","modified":1661396701584},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"2fb74d0b0e4b98749427c5a1a1b0acb6c85fadc4","modified":1661396701583},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"fed069baa9b383f57db32bb631115071d29bdc60","modified":1661396701584},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"6311eda08e4515281c51bd49f43902a51832383c","modified":1661396701584},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1661396701584},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1661396701584},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"ebecba46a5f4efe1c98a386df06c56e26fbd07b9","modified":1661396701585},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":1661396701585},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":1661396701591},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":1661396701586},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"6d6474ef186c18d9b4f334e1f735eadd6699effa","modified":1661396701595},{"_id":"themes/butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":1661396701595},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":1661396701595},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"142621f70bedcb5033ee99a988f7bb6c5eea3493","modified":1661396701597},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1661396701597},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1661396701597},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1661396701597},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"e37468e63db2a0ac09b65d21b7de3e62425bb455","modified":1661396701598},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1661396701598},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1661396701598},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"9c1229af6ab48961021886882c473514101fba21","modified":1661396701598},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"6d93564a8bd13cb9b52ee5e178db3bcbf18b1bc6","modified":1661396701598},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":1661396701598},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":1661396701599},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1661396701599},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"7fb096656c8a6c21a4b6a5100885b1081d6021ed","modified":1661396701599},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"644d520fe80cc82058467708ab82ccad313b0c27","modified":1661396701606},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"438aea3e713ed16b7559b9a80a9c5ec0221263df","modified":1661396701599},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1661396701608},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"2f95e99b8351fbecd9037a1bbdc3fee9d6ea8a77","modified":1661396701606},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"714f19e7d66df84938bd1b82b33d5667abe1f147","modified":1661396701606},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"a0010d833ed30211601c1e0bbbc68e85b77428c6","modified":1661396701608},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"26be2afa9d4e7016cf3c42a6cd166f01e8e4ad5c","modified":1661396701609},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":1661396701608},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":1661396701609},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"ef21990de28bd75dcd0f88b8d616e1a7a137502f","modified":1661396701609},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1661396701610},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1661396701610},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"a457a0dbe23af21a7b6b8bfc5ee103c9fe92e89c","modified":1661396701609},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":1661396701610},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"15056fba0bd5a45ea8dc97eb557f6929ff16797a","modified":1661396701610},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"bd88ee30ebf8ca2e7b4d3a034c317fd61733921f","modified":1661396701611},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"631ca35a38bc4ac052e9caf47508ff1f99842fc7","modified":1661396701611},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"8314e9749eb1ae40c4bae9735b7a6638b2d6876a","modified":1661396701611},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"69f8e9414526dfda3af9a71c8e528fdd0ecbbfe5","modified":1661396701612},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"a92984f566c97bb4179f34be79240af1552c6f17","modified":1661396701611},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1661396701612},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"a58d35d698885f1034dedbe99f7dbc1a801412c6","modified":1661396701613},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"6f4b4ede52305bce9b22c8c897dcbde8af6e2ce4","modified":1661396701612},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1661396701613},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1661396701612},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"8c90483d461e09cb06e91b16d8bb7b3205b0a40c","modified":1661396701613},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"25e58a7a8bda4b73d0a0e551643ca01b09ccd7e5","modified":1661396701614},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"a310e48f826a4cacc55d8e68f43806e5085554f6","modified":1661396701614},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"51e45625929d57c9df3ba9090af99b9b7bb9a15b","modified":1661396701614},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1661396701613},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1661396701614},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"39d61cbe0c1e937f83ba3b147afaa29b4de2f87d","modified":1661396701614},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1661396701615},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1661396701615},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1661396701615},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1661396701615},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":1661396701615},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"85ae91c83691ea4511f4277da1194a185251cc78","modified":1661396701615},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1661396701616},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1661396701616},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"9feb248552667c53ce1b19bc7a295215f8c77008","modified":1661396701619},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"3071a4208fdf89ad7e0031536dd6ffa7bc951e4d","modified":1661396701619},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"f0ddc0f1ffee143d86c81bee1136ae6ee01e8ea5","modified":1661396701586},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":1661396701586},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"99d9b17668260b242749c16851d9ec1024d31899","modified":1661396701586},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":1661396701587},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":1661396701587},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"58406a7a3bf45815769f652bf3ef81e57dcd07eb","modified":1661396701587},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"39427e107230a10790972349c9dd4c4f31d55eb7","modified":1661396701587},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"5f648086a33a32d169a2f8d8c549c08aa02f67db","modified":1661396701587},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"481cd5053bafb1a19f623554a27d3aa077ea59c3","modified":1661396701588},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"0611d9216f4c128ebdea4cc21454c3dc4a6398d5","modified":1661396701588},{"_id":"themes/butterfly/layout/includes/third-party/chat/gitter.pug","hash":"d1d2474420bf4edc2e43ccdff6f92b8b082143df","modified":1661396701588},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"76634112c64023177260d1317ae39cef2a68e35f","modified":1661396701588},{"_id":"themes/butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"cfe63e7d26a6665df6aa32ca90868ad48e05ec04","modified":1661396701588},{"_id":"themes/butterfly/layout/includes/third-party/chat/messenger.pug","hash":"bfe7b5a8fad041b63a10c6c6ed02e7c87afb94cd","modified":1661396701588},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"49dcc23815e1d5264bb65c91e7dc67b1a723d1ea","modified":1661396701589},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"2c095186033b6b273634ce97a75873da1f3646db","modified":1661396701589},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"24a926756c2300b9c561aaab6bd3a71fdd16e16d","modified":1661396701589},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"591ef23c583690bd74af0cafb09af64ba5bd8151","modified":1661396701590},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"8ec24c1939895ac0db2b2e8700bc9307b4ceb53c","modified":1661396701589},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"98ef20f8a3b10c1692f9b2b3c06033d2da8a8eae","modified":1661396701589},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"22e2ef30fe5eb1db7566e89943c74ece029b2a8e","modified":1661396701590},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"351fe25fbf02635b1f9e86e5e244c7d61f69baa7","modified":1661396701590},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":1661396701590},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":1661396701590},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"e18fbd88d8942e53e771f29b26209ab735c5c567","modified":1661396701591},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"e9bdf80d6796afc04eb809dbbe780d97f22c7fcd","modified":1661396701590},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"a737046e730eb7264606ba0536218964044492f9","modified":1661396701591},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"15462d1ed04651ad3b430c682842ac400f6f9b47","modified":1661396701591},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"e55b9c0f8ced231f47eb88bd7f4ec99f29c5c29d","modified":1661396701591},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1661396701592},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"f4dc7d02c8192979404ae9e134c5048d3d0a76e2","modified":1661396701592},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"dfcbd9881be569ea420eff1a6b00e4f4dbe2138e","modified":1661396701592},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"8e33aca36a4d3ae9e041ba05ced8eff56ae38f77","modified":1661396701592},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"c12c898b35dd014780c1f3220ddbe12e7270983c","modified":1661396701593},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"04b2a5882e789a988e41d45abe606f0617b08e38","modified":1661396701593},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"e846ddfe4a63b15d1416f6055f5756af5e3da7c6","modified":1661396701593},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"ab167c00da4506f591b96f0591bf5bd214a26d4b","modified":1661396701594},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":1661396701593},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"233907dd7f5b5f33412701d2ccffbc0bbae8707b","modified":1661396701594},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d19e1c2c0a50f0e4547d71a17b9be88e8152f17c","modified":1661396701594},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"dd0bc119029b62dce5dc965d5de7377e438fa29a","modified":1661396701594},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"da3b9437d061ee68dbc383057db5c73034c49605","modified":1661396701595},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"e8245d0b4933129bb1c485d8de11a9e52e676348","modified":1661396701595},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"178c9cdcc4ce5a006885b24ce4a3d624e4734899","modified":1661396701596},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":1661396701596},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1661396701596},{"_id":"themes/butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":1661396701596},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"f61d63724ea5c5f352568b3a16bde023affefbe5","modified":1661396701596},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1661396701607},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1661396701607},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1661396701607},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":1661396701608},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1661396701607},{"_id":"public/archives/2021/08/index.html","hash":"a1980da497f77bf3e705f69990a6a264e4ac6c2d","modified":1661398059602},{"_id":"public/archives/2021/index.html","hash":"223a7dcce732291192bf1e730272c2bc6fba72b5","modified":1661398059602},{"_id":"public/archives/2021/12/index.html","hash":"00f9f02d6142bcd3b6ee700d42b9ff79e93210d8","modified":1661398059602},{"_id":"public/archives/2022/index.html","hash":"f54ebb3dc798d9363119fba7ee685cad01f0806e","modified":1661398059602},{"_id":"public/archives/2022/01/index.html","hash":"229337286c01b6a1cf0add5c0e02582e09e5f50b","modified":1661398059602},{"_id":"public/tags/javascript/index.html","hash":"3dc13fb5fadb4af62fa84f55f8e7cde3d158663d","modified":1661398059602},{"_id":"public/2022/01/18/Vue3源码学习/index.html","hash":"a97aa914a08ff8f8152e8a40fc9460f6fe98b38f","modified":1661398059602},{"_id":"public/2021/12/19/Windows-Terminal-powershell-美化/index.html","hash":"5f5f8d04a6678d9d2551d422bf007307a8e1ac47","modified":1661398059602},{"_id":"public/2021/08/22/撸一个Promise/index.html","hash":"f38143dbddd2597db14465f20ec5ea79323874f2","modified":1661398059602},{"_id":"public/archives/index.html","hash":"191efd490b0ff51010efde3e37b6b7a720469aab","modified":1661398059602},{"_id":"public/index.html","hash":"5f61dcb8f58ef830366c5272c19dc3b565f74c30","modified":1661398059602},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1661398059602},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1661398059602},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1661398059602},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1661398059602},{"_id":"public/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1661398059602},{"_id":"public/js/search/algolia.js","hash":"9feb248552667c53ce1b19bc7a295215f8c77008","modified":1661398059602},{"_id":"public/js/search/local-search.js","hash":"3071a4208fdf89ad7e0031536dd6ffa7bc951e4d","modified":1661398059602},{"_id":"public/css/index.css","hash":"4a1dbcd9f81c824c79d794be609281d34c422f28","modified":1661398059602},{"_id":"public/js/main.js","hash":"73d2624ed465e4cfb1ebb00b2c8a24f5fc29bb21","modified":1661398059602},{"_id":"public/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1661398059602}],"Category":[],"Data":[],"Page":[],"Post":[{"title":"Vue3源码学习","date":"2022-01-18T02:31:08.000Z","_content":"\n# Vue3初始化流程\n创建vnode -> 初始化数据 -> proxy -> setup context -> ReactiveEffect -> run\n\n\n## 重点\n- 依赖收集\n- path\n- proxy","source":"_posts/Vue3源码学习.md","raw":"---\ntitle: Vue3源码学习\ndate: 2022-01-18 10:31:08\ntags:\n---\n\n# Vue3初始化流程\n创建vnode -> 初始化数据 -> proxy -> setup context -> ReactiveEffect -> run\n\n\n## 重点\n- 依赖收集\n- path\n- proxy","slug":"Vue3源码学习","published":1,"updated":"2022-01-18T03:30:22.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl78hibhm0000xmmo796seshe","content":"<h1 id=\"Vue3初始化流程\"><a href=\"#Vue3初始化流程\" class=\"headerlink\" title=\"Vue3初始化流程\"></a>Vue3初始化流程</h1><p>创建vnode -&gt; 初始化数据 -&gt; proxy -&gt; setup context -&gt; ReactiveEffect -&gt; run</p>\n<h2 id=\"重点\"><a href=\"#重点\" class=\"headerlink\" title=\"重点\"></a>重点</h2><ul>\n<li>依赖收集</li>\n<li>path</li>\n<li>proxy</li>\n</ul>\n","site":{"data":{}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Vue3初始化流程\"><a href=\"#Vue3初始化流程\" class=\"headerlink\" title=\"Vue3初始化流程\"></a>Vue3初始化流程</h1><p>创建vnode -&gt; 初始化数据 -&gt; proxy -&gt; setup context -&gt; ReactiveEffect -&gt; run</p>\n<h2 id=\"重点\"><a href=\"#重点\" class=\"headerlink\" title=\"重点\"></a>重点</h2><ul>\n<li>依赖收集</li>\n<li>path</li>\n<li>proxy</li>\n</ul>\n"},{"title":"Windows Terminal + powershell 美化","date":"2021-12-19T11:42:51.000Z","_content":"\n# Windows Terminal + powershell 美化\n","source":"_posts/Windows-Terminal-powershell-美化.md","raw":"---\ntitle: Windows Terminal + powershell 美化\ndate: 2021-12-19 19:42:51\ntags:\n---\n\n# Windows Terminal + powershell 美化\n","slug":"Windows-Terminal-powershell-美化","published":1,"updated":"2021-12-26T04:04:36.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl78hibhq0001xmmo4depb6qw","content":"<h1 id=\"Windows-Terminal-powershell-美化\"><a href=\"#Windows-Terminal-powershell-美化\" class=\"headerlink\" title=\"Windows Terminal + powershell 美化\"></a>Windows Terminal + powershell 美化</h1>","site":{"data":{}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Windows-Terminal-powershell-美化\"><a href=\"#Windows-Terminal-powershell-美化\" class=\"headerlink\" title=\"Windows Terminal + powershell 美化\"></a>Windows Terminal + powershell 美化</h1>"},{"title":"撸一个Promise","date":"2021-08-22T00:50:39.000Z","_content":"\n## 手撸一个 Promise\n\n- https://mp.weixin.qq.com/s/-2vIKWRPzdXCZlPupw4XcA\n\n- 一个**Promise**包括私有状态，内部方法，静态方法等。\n\n### 私有属性(外部无法访问)\n\n- 状态: **pending** 初始化状态,**fulfilled** 兑现(完成),**rejected**拒绝\n- 值 **PromiseState** **PromiseResult**\n- 值由 **resolve**或**reject**决定\n\n### 实例方法\n\n- then\n- catch\n- finally\n\n### 静态方法\n\n- Promise.reject\n- Promise.resolve\n- Promise.race\n- Promise.all\n- Promise.allSettled\n- Promise.any\n\n## 实现\n\n- 基础类\n\n```ts\nenum PROMISE_STATES ｛\n  PENDING = 'pending',\n  FULFILLED = 'fulfilled',\n  REJECTED = 'rejected'\n｝\n\ntype PromiseStates = PROMISE_STATES.PENDING | PROMISE_STATES.FULFILLED | PROMISE.REJECTED\n\nexport const isFunction = (fn: any): boolean => typeof fn === 'function';\nexport const isObject = (obj: any): boolean => typeof obj === 'object';\n\nexport interface ICallbackFn {\n  (value?: any): any\n}\n\ntype CallbackParams = ICallbackFn | null\n\nexport interface IExecutorFn {\n  (resolve: ICallbackFn, reject: ICallbackFn): any\n}\n\n\nclass PromiseLike {\n  protected PromiseState: PromiseStates;\n  protected PromiseResult: any;\n\n  resolveCallbackQueues: Array<ICallbackFn>\n  rejectCallbackQueues: Array<ICallbackFn>\n\n\n  construtor(executor) {\n    if (!isFunction(executor)) {\n      throw new Error('Promise resolver undefined is not a function')\n    }\n    this.PromiseState = PROMISE_STATES.PENDING\n    this.PromiseResult = undefined\n\n    // 保存两个事件的数组\n    this.resolveCallbackQueues = []\n    this.rejectCallbackQueues = []\n\n    executor(this._resolve, this._reject)\n  }\n\n  static all(promises: Array<ICallbackFn>) {\n    return new PromiseLike((resolve, reject) => {\n      const len = promises.length\n      let resolvedPromisesCount = 0\n      let resolvedPromisesResult = <any>[]\n      for (let i = 0; i < len; i++) {\n        const currentPromise = promises[i]\n        PromiseLike.resolve(currentPromise)\n        .then((res: any) => {\n          resolvedPromisesCount++\n          resolvedPromisesResult[i] = res\n          if (resolvedPromisesCount ===  len) {\n            resolve(resolvedPromisesResult)\n          }\n        })\n        .catch((err: any) => {\n          reject(err)\n        })\n      }\n    })\n  }\n\n  static race(promises: Array<ICallbackFn>) {\n    return new PromiseLike((resolve, reject) => {\n      for (leet i = 0; i < promises.length; i++) {\n        const currentPromise = promises[i]\n        PromiseLik.resolve(currentPromise)\n          .then((res: any) => {\n            resolve(res)\n          })\n          .catch((err: any) => {\n            reject(err)\n          })\n      }\n    })\n  }\n\n  static is(promise: PromiseType) {\n    return promise instanceof PromiseLike\n  }\n\n  static resolve(value?: any) {\n    // 如果已经是promise，就不需要再封装了\n    if (PromiseLike.is(value)) {\n      return value\n    }\n    return new PromiseLike(resolve => resolve(value))\n  }\n\n  static reject(value?: any) {\n    return new PromiseLike((resolve, reject) => reject(value))\n  }\n\n  _resolve = (value?: any) => {\n    const resolveCb = () => {\n      if (this.PromiseState !== PROMISE_STATES.PENDING) {\n        return\n      }\n      while (this.resolveCallbackQueues.length > 0) {\n        const fn = this.resolveCallbackQueues.shift()\n        fn && fn(value)\n      }\n      this.PromiseState = PROMISE_STATES.FULFILLED\n      this.PromiseResult = value\n    }\n    // 让任务变成异步\n    setTimeout(resolveCb,0)\n  }\n\n  _reject = (value?: any) => {\n    const rejectCb = () => {\n      if (this.PromiseState !== PROMISE_STATES.PENDING) {\n        return\n      }\n      while(this.rejectCallbackQueues.length > 0) {\n        const fn = this.rejectCallbackQueues.shift()\n        fn && fn(value)\n      }\n      this.PromiseState = PROMISE_STATES.REJECTED\n      this.PromiseResult = value\n    }\n    // 让任务变成异步\n    setTimeout(resolveCb, 0)\n  }\n\n  then = (onFulfilled: CallbackParams, onRejected: CallbackParams) => {\n    // 默认处理\n    onFulfilled = isFunction(onFulfilled) ? onFulfilled : value => value\n    onRejected = isFunction(onRejected) ? onRejected : err => { throw err; }\n\n    return new PromiseLike((resolve, reject) => {\n\n      const handleFulfilled = (val: any) => {\n        try {\n          const res = onFulfilled(val)\n          resolve(res)\n        } catch (error) {\n          reject(error)\n        }\n      }\n\n      const handleRejected = (val: any) => {\n        try {\n          const res = onRejected(val)\n          reject(res)\n        } catch(error) {\n          reject(error)\n        }\n      }\n\n      switch (this.PromiseState) {\n        case PENDING:\n          isFunction(onFulfilled) && this.resolveCallbackQueues.push(onFulfilled)\n          isFunction(onRejected) && this.rejectCallbackQueues.push(onRejected)\n        case FULFILLED:\n          handleFulfilled(this.PromiseResult)\n          break\n        case REJECTED:\n          handleRejected(this.PromiseResult)\n          break\n      }\n      return this\n    }\n  }\n\n  catch = (rejectedCb: CallbackParams) => {\n    return this.then(null, rejectedCb)\n  }\n\n  finally = (finallyCb: CallbackParams) => {\n    return this.then(\n      val => PromiseLike.resolve(finallyCb && finallyCb()).then(() => val),\n      err => PromiseLike.reject(finallyCb && finallyCb()).then(() => { throw err })\n    )\n  }\n\n}\n\n```\n\n### 要点\n\n- 有自己的私有状态，也有改变私有状态的方法\n- 接收一个执行函数作为参数，执行函数内部是预定义好的私有方法\n- 私有状态一旦改变(兑现或拒绝)后不可逆\n","source":"_posts/撸一个Promise.md","raw":"---\ntitle: 撸一个Promise\ndate: 2021-08-22 08:50:39\ntags: javascript\n---\n\n## 手撸一个 Promise\n\n- https://mp.weixin.qq.com/s/-2vIKWRPzdXCZlPupw4XcA\n\n- 一个**Promise**包括私有状态，内部方法，静态方法等。\n\n### 私有属性(外部无法访问)\n\n- 状态: **pending** 初始化状态,**fulfilled** 兑现(完成),**rejected**拒绝\n- 值 **PromiseState** **PromiseResult**\n- 值由 **resolve**或**reject**决定\n\n### 实例方法\n\n- then\n- catch\n- finally\n\n### 静态方法\n\n- Promise.reject\n- Promise.resolve\n- Promise.race\n- Promise.all\n- Promise.allSettled\n- Promise.any\n\n## 实现\n\n- 基础类\n\n```ts\nenum PROMISE_STATES ｛\n  PENDING = 'pending',\n  FULFILLED = 'fulfilled',\n  REJECTED = 'rejected'\n｝\n\ntype PromiseStates = PROMISE_STATES.PENDING | PROMISE_STATES.FULFILLED | PROMISE.REJECTED\n\nexport const isFunction = (fn: any): boolean => typeof fn === 'function';\nexport const isObject = (obj: any): boolean => typeof obj === 'object';\n\nexport interface ICallbackFn {\n  (value?: any): any\n}\n\ntype CallbackParams = ICallbackFn | null\n\nexport interface IExecutorFn {\n  (resolve: ICallbackFn, reject: ICallbackFn): any\n}\n\n\nclass PromiseLike {\n  protected PromiseState: PromiseStates;\n  protected PromiseResult: any;\n\n  resolveCallbackQueues: Array<ICallbackFn>\n  rejectCallbackQueues: Array<ICallbackFn>\n\n\n  construtor(executor) {\n    if (!isFunction(executor)) {\n      throw new Error('Promise resolver undefined is not a function')\n    }\n    this.PromiseState = PROMISE_STATES.PENDING\n    this.PromiseResult = undefined\n\n    // 保存两个事件的数组\n    this.resolveCallbackQueues = []\n    this.rejectCallbackQueues = []\n\n    executor(this._resolve, this._reject)\n  }\n\n  static all(promises: Array<ICallbackFn>) {\n    return new PromiseLike((resolve, reject) => {\n      const len = promises.length\n      let resolvedPromisesCount = 0\n      let resolvedPromisesResult = <any>[]\n      for (let i = 0; i < len; i++) {\n        const currentPromise = promises[i]\n        PromiseLike.resolve(currentPromise)\n        .then((res: any) => {\n          resolvedPromisesCount++\n          resolvedPromisesResult[i] = res\n          if (resolvedPromisesCount ===  len) {\n            resolve(resolvedPromisesResult)\n          }\n        })\n        .catch((err: any) => {\n          reject(err)\n        })\n      }\n    })\n  }\n\n  static race(promises: Array<ICallbackFn>) {\n    return new PromiseLike((resolve, reject) => {\n      for (leet i = 0; i < promises.length; i++) {\n        const currentPromise = promises[i]\n        PromiseLik.resolve(currentPromise)\n          .then((res: any) => {\n            resolve(res)\n          })\n          .catch((err: any) => {\n            reject(err)\n          })\n      }\n    })\n  }\n\n  static is(promise: PromiseType) {\n    return promise instanceof PromiseLike\n  }\n\n  static resolve(value?: any) {\n    // 如果已经是promise，就不需要再封装了\n    if (PromiseLike.is(value)) {\n      return value\n    }\n    return new PromiseLike(resolve => resolve(value))\n  }\n\n  static reject(value?: any) {\n    return new PromiseLike((resolve, reject) => reject(value))\n  }\n\n  _resolve = (value?: any) => {\n    const resolveCb = () => {\n      if (this.PromiseState !== PROMISE_STATES.PENDING) {\n        return\n      }\n      while (this.resolveCallbackQueues.length > 0) {\n        const fn = this.resolveCallbackQueues.shift()\n        fn && fn(value)\n      }\n      this.PromiseState = PROMISE_STATES.FULFILLED\n      this.PromiseResult = value\n    }\n    // 让任务变成异步\n    setTimeout(resolveCb,0)\n  }\n\n  _reject = (value?: any) => {\n    const rejectCb = () => {\n      if (this.PromiseState !== PROMISE_STATES.PENDING) {\n        return\n      }\n      while(this.rejectCallbackQueues.length > 0) {\n        const fn = this.rejectCallbackQueues.shift()\n        fn && fn(value)\n      }\n      this.PromiseState = PROMISE_STATES.REJECTED\n      this.PromiseResult = value\n    }\n    // 让任务变成异步\n    setTimeout(resolveCb, 0)\n  }\n\n  then = (onFulfilled: CallbackParams, onRejected: CallbackParams) => {\n    // 默认处理\n    onFulfilled = isFunction(onFulfilled) ? onFulfilled : value => value\n    onRejected = isFunction(onRejected) ? onRejected : err => { throw err; }\n\n    return new PromiseLike((resolve, reject) => {\n\n      const handleFulfilled = (val: any) => {\n        try {\n          const res = onFulfilled(val)\n          resolve(res)\n        } catch (error) {\n          reject(error)\n        }\n      }\n\n      const handleRejected = (val: any) => {\n        try {\n          const res = onRejected(val)\n          reject(res)\n        } catch(error) {\n          reject(error)\n        }\n      }\n\n      switch (this.PromiseState) {\n        case PENDING:\n          isFunction(onFulfilled) && this.resolveCallbackQueues.push(onFulfilled)\n          isFunction(onRejected) && this.rejectCallbackQueues.push(onRejected)\n        case FULFILLED:\n          handleFulfilled(this.PromiseResult)\n          break\n        case REJECTED:\n          handleRejected(this.PromiseResult)\n          break\n      }\n      return this\n    }\n  }\n\n  catch = (rejectedCb: CallbackParams) => {\n    return this.then(null, rejectedCb)\n  }\n\n  finally = (finallyCb: CallbackParams) => {\n    return this.then(\n      val => PromiseLike.resolve(finallyCb && finallyCb()).then(() => val),\n      err => PromiseLike.reject(finallyCb && finallyCb()).then(() => { throw err })\n    )\n  }\n\n}\n\n```\n\n### 要点\n\n- 有自己的私有状态，也有改变私有状态的方法\n- 接收一个执行函数作为参数，执行函数内部是预定义好的私有方法\n- 私有状态一旦改变(兑现或拒绝)后不可逆\n","slug":"撸一个Promise","published":1,"updated":"2021-08-22T06:34:36.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl78hibhs0002xmmoavp33st5","content":"<h2 id=\"手撸一个-Promise\"><a href=\"#手撸一个-Promise\" class=\"headerlink\" title=\"手撸一个 Promise\"></a>手撸一个 Promise</h2><ul>\n<li><p><a href=\"https://mp.weixin.qq.com/s/-2vIKWRPzdXCZlPupw4XcA\">https://mp.weixin.qq.com/s/-2vIKWRPzdXCZlPupw4XcA</a></p>\n</li>\n<li><p>一个<strong>Promise</strong>包括私有状态，内部方法，静态方法等。</p>\n</li>\n</ul>\n<h3 id=\"私有属性-外部无法访问\"><a href=\"#私有属性-外部无法访问\" class=\"headerlink\" title=\"私有属性(外部无法访问)\"></a>私有属性(外部无法访问)</h3><ul>\n<li>状态: <strong>pending</strong> 初始化状态,<strong>fulfilled</strong> 兑现(完成),<strong>rejected</strong>拒绝</li>\n<li>值 <strong>PromiseState</strong> <strong>PromiseResult</strong></li>\n<li>值由 <strong>resolve</strong>或<strong>reject</strong>决定</li>\n</ul>\n<h3 id=\"实例方法\"><a href=\"#实例方法\" class=\"headerlink\" title=\"实例方法\"></a>实例方法</h3><ul>\n<li>then</li>\n<li>catch</li>\n<li>finally</li>\n</ul>\n<h3 id=\"静态方法\"><a href=\"#静态方法\" class=\"headerlink\" title=\"静态方法\"></a>静态方法</h3><ul>\n<li>Promise.reject</li>\n<li>Promise.resolve</li>\n<li>Promise.race</li>\n<li>Promise.all</li>\n<li>Promise.allSettled</li>\n<li>Promise.any</li>\n</ul>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><ul>\n<li>基础类</li>\n</ul>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">enum</span> PROMISE_STATES ｛</span><br><span class=\"line\">  PENDING = <span class=\"string\">&#x27;pending&#x27;</span>,</span><br><span class=\"line\">  FULFILLED = <span class=\"string\">&#x27;fulfilled&#x27;</span>,</span><br><span class=\"line\">  REJECTED = <span class=\"string\">&#x27;rejected&#x27;</span></span><br><span class=\"line\">｝</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> PromiseStates = PROMISE_STATES.PENDING | PROMISE_STATES.FULFILLED | PROMISE.REJECTED</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> isFunction = (fn: <span class=\"built_in\">any</span>): <span class=\"function\"><span class=\"params\">boolean</span> =&gt;</span> <span class=\"keyword\">typeof</span> fn === <span class=\"string\">&#x27;function&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> isObject = (obj: <span class=\"built_in\">any</span>): <span class=\"function\"><span class=\"params\">boolean</span> =&gt;</span> <span class=\"keyword\">typeof</span> obj === <span class=\"string\">&#x27;object&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> ICallbackFn &#123;</span><br><span class=\"line\">  (value?: <span class=\"built_in\">any</span>): <span class=\"built_in\">any</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> CallbackParams = ICallbackFn | <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> IExecutorFn &#123;</span><br><span class=\"line\">  (resolve: ICallbackFn, <span class=\"attr\">reject</span>: ICallbackFn): <span class=\"built_in\">any</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromiseLike</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">protected</span> PromiseState: PromiseStates;</span><br><span class=\"line\">  <span class=\"keyword\">protected</span> PromiseResult: <span class=\"built_in\">any</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  resolveCallbackQueues: <span class=\"built_in\">Array</span>&lt;ICallbackFn&gt;</span><br><span class=\"line\">  rejectCallbackQueues: <span class=\"built_in\">Array</span>&lt;ICallbackFn&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">construtor</span>(<span class=\"params\">executor</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isFunction(executor)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;Promise resolver undefined is not a function&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.PromiseState = PROMISE_STATES.PENDING</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.PromiseResult = <span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 保存两个事件的数组</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.resolveCallbackQueues = []</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.rejectCallbackQueues = []</span><br><span class=\"line\"></span><br><span class=\"line\">    executor(<span class=\"built_in\">this</span>._resolve, <span class=\"built_in\">this</span>._reject)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">all</span>(<span class=\"params\">promises: <span class=\"built_in\">Array</span>&lt;ICallbackFn&gt;</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> len = promises.length</span><br><span class=\"line\">      <span class=\"keyword\">let</span> resolvedPromisesCount = <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> resolvedPromisesResult = &lt;<span class=\"built_in\">any</span>&gt;[]</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> currentPromise = promises[i]</span><br><span class=\"line\">        PromiseLike.resolve(currentPromise)</span><br><span class=\"line\">        .then(<span class=\"function\">(<span class=\"params\">res: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">          resolvedPromisesCount++</span><br><span class=\"line\">          resolvedPromisesResult[i] = res</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (resolvedPromisesCount ===  len) &#123;</span><br><span class=\"line\">            resolve(resolvedPromisesResult)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .catch(<span class=\"function\">(<span class=\"params\">err: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">          reject(err)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">race</span>(<span class=\"params\">promises: <span class=\"built_in\">Array</span>&lt;ICallbackFn&gt;</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (leet i = <span class=\"number\">0</span>; i &lt; promises.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> currentPromise = promises[i]</span><br><span class=\"line\">        PromiseLik.resolve(currentPromise)</span><br><span class=\"line\">          .then(<span class=\"function\">(<span class=\"params\">res: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">            resolve(res)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          .catch(<span class=\"function\">(<span class=\"params\">err: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">            reject(err)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">is</span>(<span class=\"params\">promise: PromiseType</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> promise <span class=\"keyword\">instanceof</span> PromiseLike</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">resolve</span>(<span class=\"params\">value?: <span class=\"built_in\">any</span></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果已经是promise，就不需要再封装了</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (PromiseLike.is(value)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> resolve(value))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">reject</span>(<span class=\"params\">value?: <span class=\"built_in\">any</span></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> reject(value))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  _resolve = <span class=\"function\">(<span class=\"params\">value?: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> resolveCb = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.PromiseState !== PROMISE_STATES.PENDING) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">while</span> (<span class=\"built_in\">this</span>.resolveCallbackQueues.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fn = <span class=\"built_in\">this</span>.resolveCallbackQueues.shift()</span><br><span class=\"line\">        fn &amp;&amp; fn(value)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.PromiseState = PROMISE_STATES.FULFILLED</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.PromiseResult = value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 让任务变成异步</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(resolveCb,<span class=\"number\">0</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  _reject = <span class=\"function\">(<span class=\"params\">value?: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> rejectCb = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.PromiseState !== PROMISE_STATES.PENDING) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">while</span>(<span class=\"built_in\">this</span>.rejectCallbackQueues.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fn = <span class=\"built_in\">this</span>.rejectCallbackQueues.shift()</span><br><span class=\"line\">        fn &amp;&amp; fn(value)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.PromiseState = PROMISE_STATES.REJECTED</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.PromiseResult = value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 让任务变成异步</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(resolveCb, <span class=\"number\">0</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  then = <span class=\"function\">(<span class=\"params\">onFulfilled: CallbackParams, onRejected: CallbackParams</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 默认处理</span></span><br><span class=\"line\">    onFulfilled = isFunction(onFulfilled) ? onFulfilled : <span class=\"function\"><span class=\"params\">value</span> =&gt;</span> value</span><br><span class=\"line\">    onRejected = isFunction(onRejected) ? onRejected : <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123; <span class=\"keyword\">throw</span> err; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> handleFulfilled = <span class=\"function\">(<span class=\"params\">val: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> res = onFulfilled(val)</span><br><span class=\"line\">          resolve(res)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">          reject(error)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> handleRejected = <span class=\"function\">(<span class=\"params\">val: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> res = onRejected(val)</span><br><span class=\"line\">          reject(res)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span>(error) &#123;</span><br><span class=\"line\">          reject(error)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.PromiseState) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> PENDING:</span><br><span class=\"line\">          isFunction(onFulfilled) &amp;&amp; <span class=\"built_in\">this</span>.resolveCallbackQueues.push(onFulfilled)</span><br><span class=\"line\">          isFunction(onRejected) &amp;&amp; <span class=\"built_in\">this</span>.rejectCallbackQueues.push(onRejected)</span><br><span class=\"line\">        <span class=\"keyword\">case</span> FULFILLED:</span><br><span class=\"line\">          handleFulfilled(<span class=\"built_in\">this</span>.PromiseResult)</span><br><span class=\"line\">          <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> REJECTED:</span><br><span class=\"line\">          handleRejected(<span class=\"built_in\">this</span>.PromiseResult)</span><br><span class=\"line\">          <span class=\"keyword\">break</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">catch</span> = <span class=\"function\">(<span class=\"params\">rejectedCb: CallbackParams</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.then(<span class=\"literal\">null</span>, rejectedCb)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">finally</span> = <span class=\"function\">(<span class=\"params\">finallyCb: CallbackParams</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">val</span> =&gt;</span> PromiseLike.resolve(finallyCb &amp;&amp; finallyCb()).then(<span class=\"function\">() =&gt;</span> val),</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> PromiseLike.reject(finallyCb &amp;&amp; finallyCb()).then(<span class=\"function\">() =&gt;</span> &#123; <span class=\"keyword\">throw</span> err &#125;)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"要点\"><a href=\"#要点\" class=\"headerlink\" title=\"要点\"></a>要点</h3><ul>\n<li>有自己的私有状态，也有改变私有状态的方法</li>\n<li>接收一个执行函数作为参数，执行函数内部是预定义好的私有方法</li>\n<li>私有状态一旦改变(兑现或拒绝)后不可逆</li>\n</ul>\n","site":{"data":{}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"手撸一个-Promise\"><a href=\"#手撸一个-Promise\" class=\"headerlink\" title=\"手撸一个 Promise\"></a>手撸一个 Promise</h2><ul>\n<li><p><a href=\"https://mp.weixin.qq.com/s/-2vIKWRPzdXCZlPupw4XcA\">https://mp.weixin.qq.com/s/-2vIKWRPzdXCZlPupw4XcA</a></p>\n</li>\n<li><p>一个<strong>Promise</strong>包括私有状态，内部方法，静态方法等。</p>\n</li>\n</ul>\n<h3 id=\"私有属性-外部无法访问\"><a href=\"#私有属性-外部无法访问\" class=\"headerlink\" title=\"私有属性(外部无法访问)\"></a>私有属性(外部无法访问)</h3><ul>\n<li>状态: <strong>pending</strong> 初始化状态,<strong>fulfilled</strong> 兑现(完成),<strong>rejected</strong>拒绝</li>\n<li>值 <strong>PromiseState</strong> <strong>PromiseResult</strong></li>\n<li>值由 <strong>resolve</strong>或<strong>reject</strong>决定</li>\n</ul>\n<h3 id=\"实例方法\"><a href=\"#实例方法\" class=\"headerlink\" title=\"实例方法\"></a>实例方法</h3><ul>\n<li>then</li>\n<li>catch</li>\n<li>finally</li>\n</ul>\n<h3 id=\"静态方法\"><a href=\"#静态方法\" class=\"headerlink\" title=\"静态方法\"></a>静态方法</h3><ul>\n<li>Promise.reject</li>\n<li>Promise.resolve</li>\n<li>Promise.race</li>\n<li>Promise.all</li>\n<li>Promise.allSettled</li>\n<li>Promise.any</li>\n</ul>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><ul>\n<li>基础类</li>\n</ul>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">enum</span> PROMISE_STATES ｛</span><br><span class=\"line\">  PENDING = <span class=\"string\">&#x27;pending&#x27;</span>,</span><br><span class=\"line\">  FULFILLED = <span class=\"string\">&#x27;fulfilled&#x27;</span>,</span><br><span class=\"line\">  REJECTED = <span class=\"string\">&#x27;rejected&#x27;</span></span><br><span class=\"line\">｝</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> PromiseStates = PROMISE_STATES.PENDING | PROMISE_STATES.FULFILLED | PROMISE.REJECTED</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> isFunction = (fn: <span class=\"built_in\">any</span>): <span class=\"function\"><span class=\"params\">boolean</span> =&gt;</span> <span class=\"keyword\">typeof</span> fn === <span class=\"string\">&#x27;function&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> isObject = (obj: <span class=\"built_in\">any</span>): <span class=\"function\"><span class=\"params\">boolean</span> =&gt;</span> <span class=\"keyword\">typeof</span> obj === <span class=\"string\">&#x27;object&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> ICallbackFn &#123;</span><br><span class=\"line\">  (value?: <span class=\"built_in\">any</span>): <span class=\"built_in\">any</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> CallbackParams = ICallbackFn | <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> IExecutorFn &#123;</span><br><span class=\"line\">  (resolve: ICallbackFn, <span class=\"attr\">reject</span>: ICallbackFn): <span class=\"built_in\">any</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromiseLike</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">protected</span> PromiseState: PromiseStates;</span><br><span class=\"line\">  <span class=\"keyword\">protected</span> PromiseResult: <span class=\"built_in\">any</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  resolveCallbackQueues: <span class=\"built_in\">Array</span>&lt;ICallbackFn&gt;</span><br><span class=\"line\">  rejectCallbackQueues: <span class=\"built_in\">Array</span>&lt;ICallbackFn&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">construtor</span>(<span class=\"params\">executor</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isFunction(executor)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">&#x27;Promise resolver undefined is not a function&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.PromiseState = PROMISE_STATES.PENDING</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.PromiseResult = <span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 保存两个事件的数组</span></span><br><span class=\"line\">    <span class=\"built_in\">this</span>.resolveCallbackQueues = []</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.rejectCallbackQueues = []</span><br><span class=\"line\"></span><br><span class=\"line\">    executor(<span class=\"built_in\">this</span>._resolve, <span class=\"built_in\">this</span>._reject)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">all</span>(<span class=\"params\">promises: <span class=\"built_in\">Array</span>&lt;ICallbackFn&gt;</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> len = promises.length</span><br><span class=\"line\">      <span class=\"keyword\">let</span> resolvedPromisesCount = <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> resolvedPromisesResult = &lt;<span class=\"built_in\">any</span>&gt;[]</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> currentPromise = promises[i]</span><br><span class=\"line\">        PromiseLike.resolve(currentPromise)</span><br><span class=\"line\">        .then(<span class=\"function\">(<span class=\"params\">res: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">          resolvedPromisesCount++</span><br><span class=\"line\">          resolvedPromisesResult[i] = res</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (resolvedPromisesCount ===  len) &#123;</span><br><span class=\"line\">            resolve(resolvedPromisesResult)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .catch(<span class=\"function\">(<span class=\"params\">err: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">          reject(err)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">race</span>(<span class=\"params\">promises: <span class=\"built_in\">Array</span>&lt;ICallbackFn&gt;</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (leet i = <span class=\"number\">0</span>; i &lt; promises.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> currentPromise = promises[i]</span><br><span class=\"line\">        PromiseLik.resolve(currentPromise)</span><br><span class=\"line\">          .then(<span class=\"function\">(<span class=\"params\">res: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">            resolve(res)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          .catch(<span class=\"function\">(<span class=\"params\">err: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">            reject(err)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">is</span>(<span class=\"params\">promise: PromiseType</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> promise <span class=\"keyword\">instanceof</span> PromiseLike</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">resolve</span>(<span class=\"params\">value?: <span class=\"built_in\">any</span></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果已经是promise，就不需要再封装了</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (PromiseLike.is(value)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> resolve(value))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"title\">reject</span>(<span class=\"params\">value?: <span class=\"built_in\">any</span></span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> reject(value))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  _resolve = <span class=\"function\">(<span class=\"params\">value?: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> resolveCb = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.PromiseState !== PROMISE_STATES.PENDING) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">while</span> (<span class=\"built_in\">this</span>.resolveCallbackQueues.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fn = <span class=\"built_in\">this</span>.resolveCallbackQueues.shift()</span><br><span class=\"line\">        fn &amp;&amp; fn(value)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.PromiseState = PROMISE_STATES.FULFILLED</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.PromiseResult = value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 让任务变成异步</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(resolveCb,<span class=\"number\">0</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  _reject = <span class=\"function\">(<span class=\"params\">value?: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> rejectCb = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.PromiseState !== PROMISE_STATES.PENDING) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">while</span>(<span class=\"built_in\">this</span>.rejectCallbackQueues.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> fn = <span class=\"built_in\">this</span>.rejectCallbackQueues.shift()</span><br><span class=\"line\">        fn &amp;&amp; fn(value)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.PromiseState = PROMISE_STATES.REJECTED</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.PromiseResult = value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 让任务变成异步</span></span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(resolveCb, <span class=\"number\">0</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  then = <span class=\"function\">(<span class=\"params\">onFulfilled: CallbackParams, onRejected: CallbackParams</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 默认处理</span></span><br><span class=\"line\">    onFulfilled = isFunction(onFulfilled) ? onFulfilled : <span class=\"function\"><span class=\"params\">value</span> =&gt;</span> value</span><br><span class=\"line\">    onRejected = isFunction(onRejected) ? onRejected : <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123; <span class=\"keyword\">throw</span> err; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PromiseLike(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> handleFulfilled = <span class=\"function\">(<span class=\"params\">val: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> res = onFulfilled(val)</span><br><span class=\"line\">          resolve(res)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">          reject(error)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> handleRejected = <span class=\"function\">(<span class=\"params\">val: <span class=\"built_in\">any</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> res = onRejected(val)</span><br><span class=\"line\">          reject(res)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span>(error) &#123;</span><br><span class=\"line\">          reject(error)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (<span class=\"built_in\">this</span>.PromiseState) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> PENDING:</span><br><span class=\"line\">          isFunction(onFulfilled) &amp;&amp; <span class=\"built_in\">this</span>.resolveCallbackQueues.push(onFulfilled)</span><br><span class=\"line\">          isFunction(onRejected) &amp;&amp; <span class=\"built_in\">this</span>.rejectCallbackQueues.push(onRejected)</span><br><span class=\"line\">        <span class=\"keyword\">case</span> FULFILLED:</span><br><span class=\"line\">          handleFulfilled(<span class=\"built_in\">this</span>.PromiseResult)</span><br><span class=\"line\">          <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> REJECTED:</span><br><span class=\"line\">          handleRejected(<span class=\"built_in\">this</span>.PromiseResult)</span><br><span class=\"line\">          <span class=\"keyword\">break</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">this</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">catch</span> = <span class=\"function\">(<span class=\"params\">rejectedCb: CallbackParams</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.then(<span class=\"literal\">null</span>, rejectedCb)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">finally</span> = <span class=\"function\">(<span class=\"params\">finallyCb: CallbackParams</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">val</span> =&gt;</span> PromiseLike.resolve(finallyCb &amp;&amp; finallyCb()).then(<span class=\"function\">() =&gt;</span> val),</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">err</span> =&gt;</span> PromiseLike.reject(finallyCb &amp;&amp; finallyCb()).then(<span class=\"function\">() =&gt;</span> &#123; <span class=\"keyword\">throw</span> err &#125;)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"要点\"><a href=\"#要点\" class=\"headerlink\" title=\"要点\"></a>要点</h3><ul>\n<li>有自己的私有状态，也有改变私有状态的方法</li>\n<li>接收一个执行函数作为参数，执行函数内部是预定义好的私有方法</li>\n<li>私有状态一旦改变(兑现或拒绝)后不可逆</li>\n</ul>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"cl78hibhs0002xmmoavp33st5","tag_id":"cl78hibht0003xmmo02g2es9y","_id":"cl78hibhv0004xmmofghq9rv4"}],"Tag":[{"name":"javascript","_id":"cl78hibht0003xmmo02g2es9y"}]}}